<html><head><title>CHANGELOG</title></head><body><!-- (jEdit options) :folding=explicit:collapseFolds=1: --><pre>
==============================================================================
===  TO DO  ==================================================================
==============================================================================
{{{ Features from MP2 missing in MP3
    Kinemage upload and viewing via PDB upload (?)
    Make simple kins via built-in Prekin scripts
    Complex Probe runs
    Half-bond coloring schemes
    JavaMage thumbnail
    User manual
    Tutorial / walk-thru
    Settable penalty function for Reduce
    Ability to hide/unhide files
    Turn off vdW and/or H-bonds in dot kins
}}}
{{{ Ideas, long-term goals, etc.
    Write a decent document about installation of MolProbity for web and script use
    Could make it a web service with XML-RPC (SOAP, CORBA too complex)
    should session lifetime be from start, or from last use?
    document PHP version needed (which is...? >=4.1:superglobals >=4.3:CLI)
        4.1.0 doesn't work on kinemage: cmd line can't load 'session mm'
        4.1.2 seems to work on glass
    user should get partial results as big job is running ?
    Should analysis of worst residues ignore water or treat it separately?
    ZIP download should include a static view of the lab notebook?
    Retrieve maps from the EDS
    Add ribbons or something else colored by (absolute) occupancy
    Make color-coded versions of the flowchart for different stages of the process?
    Multicrit: views for trouble spots sorted by severity (also hypertext?)
    Create scripts for generating usage stats from molprobity.log
    User sort multi chart by columns
    Estimate time for e.g. analysis jobs?
    Cache commonly run (or all) standard PDB queries?
    Cache feedback emails in MySQL database as well as filesystem?
    Add "priviledged" users who can e.g. run extra NMR models
    Allow uploads of tarballs of NMR models?
    On upload of alt conf model, do table to choose which ones to use
    "nice" large jobs such as multi-model NMR runs
    "URL filesystem" to load/append/save kins from KiNG
    Kinemage upload and viewing tool
    Eliminate AAC kin completely
    Have "all" analysis run use PDBstat to run Rama only on protein, etc
    Allow "hidden" user files; default download doesn't include these?
}}}
    Allow simple comparison of bad residues in two models; see jobs/analyze.php
    Rama outliers in multicrit kin don't look so hot (Ca-Ca, yellow?)
    Waters are dots instead of balls??
    No sc master on rotamers (how?)
    Develop multi-model version of the multicrit kin
    ORACLE output for TN Bhat
    Add documentation to the analysis results page (how to interpret)
    Add explanation of SSWING on setup page
    Explicitly allow upload of kins
    Display comparison to run-of-PDB for clash score
    Specify what a CB outlier is
    Explain 2d and 3d CB kins
    Make sure Reduce doesn't shrink the PDB file (lost atoms, etc)
    Add session resume link to preformatted email
    Make clashscore a choice during analysis

==============================================================================
===  CHANGE LOG  =============================================================
==============================================================================

### 3beta7 ###
- added forms for ED map and het dictionary upload
- moved session, errors, lifetime, labbook, progress to system/ folder.

### 3beta6 ###
- created MVC/delegate architecture in public_thml/index.php
  and lib/event-page.php. See those files for documentation.
- added clearstatcache() to session read, just in case (ala lab notebook)
- created "site map" page based on the MVC/events model
- ported notebook view/edit pages to MVC/events model
- remodeled core.php:mpNavigationBar() to work with MVC/events
- added base class for all MVC/events delegate classes (works w/ nav bar)
*******************************************************************************
* NON-MVC MOLPROBITY3 IS NOW OFFICIALLY BROKEN. FURTHER WORK MUST USE MVC!    *
*******************************************************************************
- BUGFIX: mpSessReadOnly() did nothing b/c variable was not marked "global"
- background event launching has been converted to MVC/event system.
  This is untested thus far but appears to be working.
- removed lib/labbook.php:openWithEdit() because old pages are broken anyway.
- considered allowing return values and handlers for pageCall() / pageReturn()
  Ended up deciding against it -- see index.php for the complete argument.
- modified style sheet to get a more subtle look
- finished file upload (except for error handling)
- fixed 'abort' function in new job progress page
- got the fetch from PDB / NDB function working
- added upload error handling
- created initial pass on the site map's formatting
  
### 3beta5 ###
- traced mysterious labbook load/save bug from beta3 to missing clearstatcache()
- used that fixed bug to simplify improve_sswing_done.php; seems to still work
- running 1S72 (lg ribosomal subunit) requires ~40 min (?) and 450 Mb on arachne
- running 1S5L (photosystem II) on arachne takes 169 min and 62% of 200 Mb
  (that's without an AAC kin). The 102 Mb multicrit kin won't load in web KiNG.

### 3beta4 ###
- changed sswing runs to use idealPDB.pdb as the output, rather than stdout
  stdout formatting was not consistent enough to rely on
* Shuren tells me this is only a starting point for optimization. There is not
* yet any file that just contains the final sidechain conformation!
- no longer allow submission of SSWING form if no maps are present
- new models from PDB/NDB are now given lowercase names
  this plays better with the xxxH.pdb convention for Reduce naming
- added "preview" links to analysis run
- added session-overwrite safeguards to viewking.php for previewing use
- created infrastructure for setting a per-user het dictionary in $_SESSION
- created upload pages for custom het dictionary
- got modified SSWING from Shuren, now read result from sidechainPDB.pdb
- changed lib/analyze to make some quick kins first to keep user entertained

### 3beta3 ###
- reworked lab notebook functions to allow automagicical entries and editing
- added automatic notebook entry for file upload
- made Analyze to Reduce -build link go to the setup page instead of improve_tab
- improved the job_progress Abort function
- added framework code to support lab book in analyze_display
  some odd hacks were required to get the right behavior -- I'd love
  to find a more elegant way of doing something like this.
- notebook edit page now protects HTML special chars properly upon save
- analysis page now generates reasonable notebook entries
- added NAR reference to home_tab.php
- added automatic labbook entry for Reduce -build
- added automatic entry for SSWING, with more ugly hacks.

### 3beta2 ###
- added timing notes to SSWING setup page
- links now highlight on hover using CSS A:hover
- changed feedback code to use \r\n instead of \n for new lines.
  This eliminates the error message, but mail still doesn't get delivered?
- now caching user feedback on disk in addition to trying to send mail.
  Not elegant, but ensures nothing is lost.
  Feedback page now doesn't report failure except in the system log.
- changed CSS to remove border from link images (needed in Mozilla)
- fixed potential div-by-0 bug in analyze_display (lines 51,59,etc)
- added display of B lt 40 clashscore
- made some timing improvements in job_progress: slows down for long jobs
- feedback page now asks user to not delete files
- fixed bugs on notebook_edit and added note about using HTML tags
- added "Close" button to kin viewing page
- added controls to set size of KiNG window
- changed "Get input models" to the more accurate "Get input files"
- added CSS for syntax highlighting of kinemage files; updated king.jar
- added syntax highlighted view of kinemage files
- fixed a file-download annoyance: now files and dirs sort separately
- added file viewing links to download page; combined viewhtml and viewtext
- fixed addmodel.php (upload system) to rename files with "weird" names
- patched filesystem-access security hole in viewtext.php
- patched filesystem-overwrite security hole in ED Map Upload system
- fixed addModel() to protect from case-insensitive file systems like OS X
- removed segID remapping from reduceNoBuild() b/c it's not appropriate
- segID remapping is now done immediately on upload
- user is now warned if segID remapping occurred
- this avoids the bug from Top500/1aacH.pdb, which had its H in segment 'new '

### 3beta1 ###
- first beta release for testing inside the Richardson lab
- rotamers weren't showing up in multi-crit kin due to a stray "s" before -scope
  Thus the error msg "Prekin can't open s-scope". Probably due to jEdit save bug

### 3pre17 ###
- decided all logging calls should be from public_html/* pages b/c we want to
  know about web traffic, not about scripted use by local users.
- inserted logging calls on many public_html pages
- got basic SSWING function working! Yay!!
- added "X minutes and Y seconds" formatting to job update page
- made "download all files" always avail. from files page
- added ED map support to viewking.php
- added custom views to the SSWING kinemage
- SSWING now creates a new model for the changes to go into
- added basic dots to SSWING kins
- added link to EDS (still need auto map download)
- modified sswing (Perl) to delete all files it creates; we use stdout only.
- changed sidechain colors for SSWING kins
- made sure proper SSWING binaries are in place for both OS X and Linux
- user can now accept or reject changes made by SSWING

### 3pre16 ###
- cleaned up lab notebook formatting a bit. Still needs better styling.
- wrote text for log out and save session pages
- wrote text for Reduce setup page
- formatted Asn/Gln/His checkbox table with MP_XXX colors
- wrote some text for after you've run Reduce
- started working on Feedback system
- completed code for Feedback system, seems to work but needs live testing
- added B-vals in pt ID and blackbody colored B-factor ribbons to multi kin
- added explanatory text to analysis setup page
- hacked together a crude multi-criterion chart
- added electron density map upload
- improved the analysis results page to make it more usable.
- added PDBSTAT text to the multicrit text window
- added makeZipForSession() to core.php
- file download page can now package things into ZIPs
- started building in mechanisms for running SSWING
- Subversion repository got screwed again!!
- upgraded to svn 1.1.0-rc1 and rebuilt repos with "fsfs" filesystem
  (fresh checkout is not needed if new repos is loaded from dump of old one)
- added SSWING binaries and scripts

### 3pre15 ###
- elaborated oneline-batch to handle running Reduce -nobuild too
  Still needs some work to really be clean.
- added listDir() to core.php
- used listDir() to clean up the weird problems with oneline-batch.php -reduce
- got new Prekin, Reduce
- learned the hard way to not do Subversion work inside sym link directories.
  I could recover by doing dump/load and a clean checkout, but scary...
- got new Reduce, Prekin binaries for the Mac
- makelinks.sh now also creates molprobity.log and sets its permissions
- still seems to work on OS X (whew...)
- changed limit for Reduce to 100,000
- added notification of disk space used
- fixed coloring issue for download table
- added robot-exclustion META to header
- cleaned up home_tab for public viewing
- added ALERT divs to home_tab and improve_reduce_choose
- commented out non-functioning placeholders in upload_tab
- dropped Reduce -limit to 10,000 b/c now 1SBP flipkins take a LONG time
- background jobs now record their PID and user can abort them (POSIX only)
  
### 3pre14 ###
- refactored multicriterion kin creation into makeMulticritKin()
- created outlier-res-batch.php to do analysis for JNB
- we now use dirname(__FILE__) instead of getcwd() to define MP3 install dir
  This means e.g. that cmdline/ scripts can be run from any directory
- removed useless Cb dev statistics
- modified pdbstat regex's again for R/Rfree to catch data from TNT
- changed resolution regex to pick up on resolutions like "2." and ".54"
- changed fixH.pdb suffix to Hfix.pdb because its easier to get right
- modified clashlist to avoid the divide-by-zero error for no atoms B &lt; 40
- made the default Linux bin dir "linux/", symlinked it to linux-rh73/
- added Perl to the list of external programs (for Mike's scripts)
- removed defunct Cb stats from oneline-batch.php
- reworked decodeReduceUsermods() to deal with rare cases that we were failing on
- added a countflips.php command-line script to checking on what Reduce did

### 3pre13 ###
- created a tmp/ directory just for use by MolProbity (file uploads, ZIPs, etc)
- allowed user to pull files from PDB
- reworked pdbstat() to be slightly more efficient (still takes ~15 sec on 1JJ2)
- upload page can deal with failed PDB/NDB upload in a basic way
- download from NDB works but is slow...
- connection to NDB FTP server takes ~30 seconds -- this is why so slow!
- added refinement program and temperature, R and Rfree to pdbstats page
- removed defunct images and mockup HTML pages
- added configuration page for Reduce -build
- incorporated Flipkin creation into the first Reduce step
- started porting the second, user-guided Reduce step
- finished the mechanics of porting the second Reduce step, now just UI tweaking
- updated the documentation on files created per model, and reorganized the sections
- added B-factor ribbons back to the multi-criteria kinemage
- made it so that second Reduce run is entirely skipped if no changes are requested
- marked models that have been through Reduce -build once; makes no sense to run them again!
- replaced progress bar image with a spinning ubiquitin ribbon drawing
- developed oneline-batch.php to extract basic quality stats from a folder of Reduced PDBs
- added calcCbetaStats() to find min, max, mode, mean, stddev
- improved REMARK regex's in pdbstat.php
- oops! I was calling the median "mode" in the above calcCbetaStats().
- code for tallying Rama outliers kept a running tally over all models (var not reset)
- Reduce 2.21 on Linux introduced line noise into some USER MODS, including ASCII 26 (hex 1a).
  Scrublines was set to terminate on this character, so I changed that and recompiled.
  This was previously causing affected PDBs to be truncated upon upload.
- improved regex's for R and Rfree to specify leading zero or decimal point
- changed loadClashlist() to guard against no clashes (and no summary!) for scores

### 3pre12 ###
- updated program requirements to list "zip"
- changed style sheet to sans-serif fonts, turned off link underlines
- changed color and upped contrast slightly on the logo
- added more elaborate flow chart
- created dummy pages for compare and improve
- created page to describe contents of uploaded file
- added Ramalyze PDF to analysis script
- swapped file upload and PDB-pull panes on upload page
- mc-mc dots in multicrit kin were actually all dots
- added reduceBuild() function to model.php
- implemented removeModel() and tested it from the command line scripts
- created a disk-too-full die() in mpInitEnvirons()
- added endsWith() to strings.php
- added system logging function. Individual user logging is of little use
  and will be effectively replaced by automated lab notebook entries.
- implemented a progress bar and list of tasks for analysis script
- did the same for addmodel and reduce-build jobs

### 3pre11 ###
- updated PDB stat to find nonpolar H in nucleic acids, too.
- updated pdbstat to find nucleic acid residues
- changed preparePDB() to not add H; now done by reduceNoBuild()
- renamed prepared() upload PDB so as not to confuse user
- reworked analysis scripts so that only selected jobs are performed
- reworked analysis so that hydrogens are added "just in time" if needed
- put both mc-mc and sc-(anything) dots in AAC kinemage, but separately
- removed Ramachandran JPEG and EPS files in anticipation of providing PDFs
- removed Mage as a necessary binary
- modified multicriterion kin to separate mc-mc and sc-x dots
- replaced findOutliers() with 4 separate functions
- analysis display page now adapts to the presence / absence of various criteria
- refactored jobs/addmodel.php into lib/model.php:addModel()
- refactored jobs/analyze.php into lib/analyze.php:runAnalysis()
- created a proof-of-concept cmd-line-driven script to use MP functions
- added machinery to create a ZIP archive of all a model's files

### 3pre10 ###
- really reworked page header/footer/styling. Style sheet hasn't been finished yet.
- removed all tab bar images and templates
- came up with a pretty decent "look" for the site; may change colors to match kinemage site
- rearranged upload page
- allowed user to revisit previously generated analysis
- each model now has its own download URL too
- implemented function to generate kinemage-viewing links
- added embedded KiNG page for kinemage viewing
- tried a pale brown background theme
- fixed accidentally introduced bug in analyze_display.php
- made nicer display of multi crit kinemage
- added Ramachandran plots to output of analysis (jpeg, kin, eps)
- added CB dev, all-atom contacts to analysis output

### 3pre9 ###
- added 'ignoreSegID' option to handle old Reduce'd files with 'new' in segID field
- loadRamachandran() and loadRotamer() now decompose residue names into parts
- loadCbetaDev() now synthesizes a residue name from the parts
- loadClashlist() now picks up worst clash per residue
- badRes now markes residues with clashes >= 0.40 A
- refactored badRes code into lib/analysis.php:findOutliers()
- started lib/visualize.php to make data visualizations
- wrote functions to find res with alt confs and guess at res center in 3-space
- started working on the new MultiCrit

### 3pre8 ###
- brought the whole project under Subversion version control
- created a shell script to restore filesystem state (symlinks and permissions)
- created analyze_display.php for Jeremy to start working in
- fixed loadCbetaDev() to deal with multiple headers from Prekin
- created a basic file-listing page
- administrator can now "enter" sessions from the monitoring page
- mocked up some HTML layouts for pages
- check script now tells about how big file uploads can be
- added "last touched" to admin page
- moved all string and formating functions to strings.php
- set svn:ignore properties on public_html/ and on symlinks in bin/
- check for presence of models before trying to list them.
  Alternately, we could just define $_SESSION['models'] = array() at startup.
  Actually, lets do that too.

### 3pre7 ###
- filled in the PDB upload form, though it doesn't do anything yet.
- implemented first cases of "More/Fewer options" links
- implemented background execution via launchBackground()
- implemented background job monitoring via job_progress.php
- file upload now works, basically, though no processing is performed.
- added config parameter MP_DEFAULT_TIMEZONE
- worked out a bug in launchBackground(): session data wasn't written immediately
- addmodel.php now does some nice pre-processing of all new models uploaded
- pdbstat now reports refinement program and temp, and a count of CNS headers
- refactored jobs/addmodel.php to facilitate future offline scripts
- created a function to write session data to disk immediately
- reworked the definition of a model entry.
  Now using -build will create a new model, so you can compare to the old.
- did proof-of-concept for Cbeta deviation analysis and clashlist

### 3pre6 ###
- filled in the Finish tab (rough draft) to allow users to log out
- described what should go in each tab

### 3pre5 ###
- fixed bug in GC function
- made PATH in config.php depend on MP_BASE_DIR
- added some things to check_config.php
- PATH setup is smarter: auto-detects OS and adds our bin/ directory
- added read-only marker for sessions to enable D&J's partial results
- it might make sense to make labbook keywords an array, but then
  transmitting them in a form becomes harder.
- started working on a standard page header
- Experimented with tables, images to make tabs. Images are a better bet.
- made first drafts of all the tab pages (empty). Linked them together.
- made labbook page work pretty well

### 3pre4 ###
- refined sessions yet again: now each top level page must know where
  the base installation directory is, relative to itself.
- session support has been reworked to use MP_BASE_DIR
- session create now defaults to false. This limits points of entry.
- added marker file for session lifetime
- added administrator overview of current sessions
- created garbage collection functions

### 3pre3 ###
- added (optional) mode to mkdir() call in sessions.php
- added time zone support to lab notebook
- continued refining session code

### 3pre2 ###
- wrote the which() part of check_config.php
- configured sessions to never use cookies
- implemented bare-bones of a lab notebook system
- rearranged how the include() system is set up

### 3pre1 ###
- built custom session-handling functions
- established simple test case for running background jobs
- started documentation

</pre></body></html>